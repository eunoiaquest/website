---
interface Props {
  animation?: 'fade-in' | 'slide-up';
  class?: string;
}

const { animation = 'slide-up', class: className = '' } = Astro.props;
---

<div class:list={['opacity-0', className]} data-animation={animation}>
  <slot />
</div>

<script>
  // Set up a single IntersectionObserver for all animated sections
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const el = entry.target as HTMLElement;
          const type = el.dataset.animation;
          if (type === 'fade-in') {
            el.classList.add('animate-fade-in');
          } else if (type === 'slide-up') {
            el.classList.add('animate-slide-up');
          }
          observer.unobserve(el); // Only trigger once
        }
      });
    },
    { threshold: 0.1 }
  );

  document.querySelectorAll('[data-animation]').forEach((el) => {
    observer.observe(el);
  });
</script>
